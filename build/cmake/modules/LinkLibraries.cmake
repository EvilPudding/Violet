
# Find libraries
macro (gather_libraries)
  foreach (lib ${POSSIBLE_LIBRARIES})
    string(TOUPPER ${lib} prefix)
    if (NOT DEFINED USE_${lib} OR USE_${lib})
      if (DEFINED ${lib}_COMMAND)
        find_package (${${prefix}_COMMAND})
      else ()
        find_package (${lib})
      endif ()
      if (${prefix}_FOUND)
        if (DEFINED ${prefix}_INCLUDE_DIRS)
          include_directories (${${prefix}_INCLUDE_DIRS})
        elseif (DEFINED ${prefix}_INCLUDE_DIR)
          include_directories (${${prefix}_INCLUDE_DIR})
        endif ()
        list (APPEND HEADER_FILES ${${prefix}_ADDITIONAL_HEADERS})
        list (APPEND SOURCE_FILES ${${prefix}_ADDITIONAL_SOURCE})
        add_definitions (${${prefix}_ADDITIONAL_DEFINITIONS})
        if (NOT ${prefix}_HEADER_ONLY)
          list (APPEND LIBRARIES ${${prefix}_LIBRARIES})
        endif ()
      else ()
        message (FATAL_ERROR "Failed to find required dependency: ${lib}")
      endif ()
    endif ()
  endforeach (lib)
endmacro (gather_libraries)
